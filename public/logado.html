  <!DOCTYPE html>
  <html lang="pt-br">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>página</title>
      <link rel="stylesheet" href="../estilo/logado.css">
  </head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 
  <body>

      

  <nav class="sidebar">
      <div>

      
        
      </div>
      
      </div>
      <div class="navbar">
          <ul>
              <li><a  href="avalie.html">Avalie o anime</a></li>
              <li><a class="selecionado" href="logado.html">Gráficos</a></li>
              <li><a href="quizz.html">Quizz</a></li>
<span style="font-size: 32px; color: #ffffff";></span>
          </ul>
      </div>
      </div>
      <button onclick="window.location.href='index.html'" onclick="sair()">Sair</button>
  </nav>
  <div class="dashboards-container" style="display: flex; width: 100%; align-items: flex-start;">
  
    
    <div class="grafico-container" style=" text-align: center; margin-top: 50px; margin-left: 200px; ">
      <div class="percentual-container">
       <div id="porcentagem_gostou1" class="percentualsim"></div>
  <div id="porcentagem_gostou0" class="percentualnao"></div>
  </div>
      <canvas id="graficoVotos" width="250" height="250" ></canvas>
      <div class="contagem">
        <p>Sim: <span id="contagem-sim">0</span></p>
        <p>Não: <span id="contagem-nao">0</span></p>
      </div>
    </div>

  
    <div id="comentarios" style="margin-left: auto;"></div>
  </div>
    
  <script src="../js/logado.js"></script>
  <script>
  let graficoVotosChart;
  function iniciarGraficoVotos(votosSim, votosNao) {
    const ctx = document.getElementById("graficoVotos").getContext("2d");
    graficoVotosChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Sim', 'Não'],
        datasets: [{
          data: [votosSim, votosNao],
          backgroundColor: [
            'rgb(75, 192, 192)',
            'rgb(255, 99, 132)'
          ],
          hoverOffset: 10
        }]
      },
      options: {
        responsive: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }


  function atualizarGraficoVotos() {
    fetch("/dash/contar-votos")
      .then(res => res.json())
      .then(data => {
        const votosSim = data.votos_sim;
        const votosNao = data.votos_nao;

        
        document.getElementById("contagem-sim").innerText = votosSim;
        document.getElementById("contagem-nao").innerText = votosNao;

        if (graficoVotosChart) {
          graficoVotosChart.data.datasets[0].data = [votosSim, votosNao];
          graficoVotosChart.update();  
        } else {
          iniciarGraficoVotos(votosSim, votosNao);
        }
      })
      .catch(err => {
        console.error("Erro ao buscar votos:", err);
      });
  }

  function carregarComentarios() {
      fetch("/dash/listarComentarios")
          .then(resposta => resposta.json())
          .then(lista => {
            var div = document.getElementById("comentarios");
              div.innerHTML = "";

              for (var i = 0; i < lista.length; i++) {
                  var comentario = lista[i].comentario;
                  var nome = lista[i].Nome;

                  div.innerHTML += `
                      <div class="comentario">
                          <p>${comentario}</p>
                          <span>- ${nome}</span>
                      </div>
                  `;
              }
          })
          .catch(erro => {
              console.log("Erro ao carregar comentários:", erro);
          });
  }
  function percentualsim() {
      fetch("/dash/percentualsim")
          .then(resposta => resposta.json())
          .then(data => {
              var div = document.getElementById("porcentagem_gostou1");

              div.innerHTML =
                  `<br> <br> <span style="font-size: 32px; color:#ffffff";>${data.resultado[0].porcentagem_gostou}%</span> <br>
                   das pessoas gostaram do anime`;
          })
          .catch(erro => {
              console.error("Erro ao carregar porcentagem:", erro);
          });
  }

   function percentualnao() {
      fetch("/dash/percentualnao")
          .then(resposta => resposta.json())
          .then(data => {
              var div = document.getElementById("porcentagem_gostou0");

              div.innerHTML =
                  `<br><br> <span style="font-size: 32px; color:#ffffff";>${data.resultado[0].porcentagem_gostou0}%</span> <br>
                    das pessoas não gostaram do anime`;
          })
          .catch(erro => {
              console.error("Erro ao carregar porcentagem:", erro);
          });
  }



  window.onload = function () {
    atualizarGraficoVotos();
    carregarComentarios();
    percentualsim();
    percentualnao();

    setInterval(atualizarGraficoVotos, 5000);
  };
  </script>
  </body>
  </html>